<!DOCTYPE html>
<html lang="en"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout_dir/layout/main_layout}">
<head>
    <meta charset="UTF-8">
    <title>기업 회원가입</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/js/api.js"></script>
    <link rel="stylesheet" href="/css/common/variable.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/css/signup.css">
    <style>

        .signup{
            box-sizing: border-box;
            display: flex;
            width: 100vw;
            justify-content: center;
            margin-bottom: 100px;
        }
 
        .signup-container {
            margin-top: 40px;
            width: 500px;
            display: flex;
            flex-direction: column;
        }

        .signup-container-top{
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            /*background-color: #45a049;*/
            border-bottom: 3px solid #a58c7a;
        }
        .signup-container-bottom{
            padding-top: 40px;
            border-radius: 10px;
            width: 100%;
        }
        h2 {
            font-weight: 550;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            box-sizing: border-box;
        }


        input:focus {
            outline: none;
            border-color: #929AA2;
        }

        .id-group {
            display: flex;
            gap: 10px;
        }

        .id-group input {
            flex: 1;
        }

        .rim-btn{
            border-radius: 15px;
            padding: 10px 20px;
            background: var(--primary-color-2);
            cursor: pointer;
        }
        .check-button {
            width: 150px;
            color: white;
            border: none;
            white-space: nowrap;
        }

        .check-button:hover {
            background: #B76737;
        }

        .submit-button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color-2);
            color: white;
            border: none;

            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        /*.submit-button:hover {*/
        /*    background: var(--primary-color-1);*/
        /*}*/

        .email-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .email-group input {
            flex: 1;
        }

        .email-group span {
            color: #666;
        }

        .birth-group {
            display: flex;
            gap: 10px;
        }

        .birth-group select {
            flex: 1;
        }

        .address-group input, .address-group button {
            margin-bottom: 10px;
        }

        #companyAddress{
            margin-bottom: 10px;
        }
        .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .required::after {
            content: " *";
            color: #f44336;
        }

        .signup-container-top h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .signup-container-top h2 i {
            color: var(--primary-color-1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 70%;
            max-width: 600px;
            border-radius: 10px;
        }

        #modalContent {
            font-weight: normal;
            color: #333333;
            font-size: 14px;
            white-space: pre-wrap;
            text-align: left;
            padding: 20px;
        }

        /* 조항 제목 스타일 */
        #modalContent .article-title {
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* 들여쓰기 적용 */
        #modalContent span + br + * {
            padding-left: 20px;
            display: block;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }


        .modal-body {
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;      /* 줄간격 조정 */
            padding: 0;            /* 기존 패딩 제거 */
        }

        .modal-body p {
            margin: 8px 0;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .terms-view {
            margin-left: auto;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: none;
            cursor: pointer;
            font-size: 12px;
        }

        .terms-view:hover {
            background-color: #f5f5f5;
        }

        /* terms 관련 스타일 추가 */
        .terms-container {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .terms-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .terms-checkbox {
            width: auto !important;  /* 기존 input 스타일 override */
            margin-right: 10px;
        }

        .terms-item label {
            margin-bottom: 0;  /* 기존 label 스타일 override */
            display: inline;   /* 기존 block에서 변경 */
        }

        .terms-notice {
            margin: 5px 0 10px;
            font-size: 12px;
            color: #888;
            line-height: 1.4;
        }

        .terms-notice p {
            margin: 2px 0;
        }

        /* 약관 컨테이너와의 간격 조정 */
        .terms-container {
            margin-top: 5px;
        }

        .terms-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px 0;
        }

        .terms-row:first-child {
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .terms-row label {
            margin: 0;
            flex: 1;
        }

        .terms-row button {
            background: none;
            border: none;
            color: #666;
            text-decoration: underline;
            cursor: pointer;
        }

    </style>
</head>
<body>
<th:block layout:fragment="content">
    <div class="signup">
        <div class="signup-container">
            <div class="signup-container-top">
                <h2><i class="fa-solid fa-building"></i>기업 회원가입</h2>
            </div>
            
            <div class="signup-container-bottom">
                <form id="signupForm">
                    <!-- 기본 정보 -->
                    <div class="form-group">
                        <label for="companyId" class="required">아이디</label>
                        <div class="id-group">
                            <input type="text" id="companyId" placeholder="영문, 숫자 4~20자">
                            <button type="button" class="rim-btn check-button" onclick="checkDuplicate()">중복확인</button>
                        </div>
                        <div class="error-message" id="companyIdError"></div>
                    </div>

                    <!-- 비밀번호 -->
                    <div class="form-group">
                        <label for="companyPw" class="required">비밀번호</label>
                        <input type="password" id="companyPw" placeholder="영문, 숫자, 특수문자 조합 8자 이상">
                        <div class="error-message" id="companyPwError"></div>
                    </div>

                    <!-- 비밀번호 확인 -->
                    <div class="form-group">
                        <label for="companyPwConfirm" class="required">비밀번호 확인</label>
                        <input type="password" id="companyPwConfirm" placeholder="비밀번호 재입력">
                        <div class="error-message" id="companyPwConfirmError"></div>
                    </div>

                    <!-- 회사명 -->
                    <div class="form-group">
                        <label for="companyName" class="required">회사명</label>
                        <input type="text" id="companyName">
                        <div class="error-message" id="companyNameError"></div>
                    </div>

                    <!-- 사업자등록번호 -->
                    <div class="form-group">
                        <label for="companyNumber" class="required">사업자등록번호</label>
                        <input type="text" id="companyNumber" placeholder="000-00-00000">
                        <div class="error-message" id="companyNumberError"></div>
                    </div>

                    <!-- 주소 -->
                    <div class="form-group">
                        <label for="companyAddress" class="required">회사 주소</label>
                        <div class="address-group">
                            <input type="text" id="companyZonecode" placeholder="우편번호" readonly>
                            <button type="button" class="rim-btn check-button" onclick="searchAddress()">주소 검색</button>
                        </div>
                        <input type="text" id="companyAddress" placeholder="기본주소" readonly>
                        <input type="text" id="companyAddressDetail" placeholder="상세주소">
                        <div class="error-message" id="companyAddressError"></div>
                    </div>

                    <!-- 연락처 -->
                    <div class="form-group">
                        <label for="companyContact" class="required">대표 연락처</label>
                        <input type="tel" id="companyContact" placeholder="000-0000-0000">
                        <div class="error-message" id="companyContactError"></div>
                    </div>

                    <!-- 이메일 -->
                    <div class="form-group">
                        <label for="emailId" class="required">이메일</label>
                        <div class="email-group">
                            <input type="text" id="emailId" placeholder="이메일">
                            <span>@</span>
                            <input type="text" id="emailDomain" placeholder="도메인">
                        </div>
                        <div class="error-message" id="companyEmailError"></div>
                    </div>

                    <!-- 선택 입력 필드들 -->
                    <div class="form-group">
                        <label for="companyWebsite">홈페이지</label>
                        <input type="url" id="companyWebsite" placeholder="https://">
                    </div>

                    <div class="form-group">
                        <label for="companyBirth">창립일</label>
                        <input type="date" id="companyBirth">
                    </div>

                    <div class="form-group">
                        <label for="companyEmployee">직원 수</label>
                        <input type="number" id="companyEmployee" placeholder="숫자만 입력">
                    </div>

                    <div class="form-group">
                        <label for="companyProfit">연간 매출액(만원)</label>
                        <input type="number" id="companyProfit" placeholder="숫자만 입력">
                    </div>

                    <!-- 약관 동의 -->
                    <div class="form-group">
                        <label class="required">약관 동의</label>
                        <div class="terms-notice">
                            <p>회원가입을 위해서는 약관을 확인하고 동의해주세요.</p>
                            <p>각 약관의 '보기' 버튼을 클릭하여 내용 확인 후 동의가 가능합니다.</p>
                        </div>
                        <div class="terms-container">
                            <div class="terms-item">
                                <input type="checkbox" id="termsAll" class="terms-checkbox">
                                <label for="termsAll" style="display: inline;">전체 동의</label>
                            </div>
                            <div class="terms-item">
                                <input type="checkbox" id="terms1" class="terms-checkbox required-terms">
                                <label for="terms1" style="display: inline;">[필수] 이용약관 동의</label>
                                <button type="button" class="terms-view" data-term-type="1">보기</button>
                            </div>
                            <div class="terms-item">
                                <input type="checkbox" id="terms2" class="terms-checkbox required-terms">
                                <label for="terms2" style="display: inline;">[필수] 개인정보 수집 및 이용 동의</label>
                                <button type="button" class="terms-view" data-term-type="2">보기</button>
                            </div>
                        </div>
                        <div class="error-message" id="termsError"></div>
                    </div>

                    <button type="submit" class="submit-button">회원가입</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 약관 모달 -->

    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalContent"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="rim-btn check-button" onclick="Terms.agree()">동의</button>
            </div>
        </div>
    </div>

    <script>
        // 약관 체크박스 초기 비활성화
        document.querySelectorAll('.required-terms').forEach(checkbox => {
            checkbox.disabled = true;  // 체크박스 비활성화
        });

        let currentTermType = null;  // 현재 보고 있는 약관 타입 저장 - 모달에서 약관 동의 시 어떤 약관에 동의했는지 식별하기 위해 필요

        // 약관 관련 객체
        const Terms = {
            // 약관 내용 정의
            contents: {
                1: {
                    title: '이용약관',
                    content: `제1조(목적) 이 약관은 주식회사 2WH(전자상거래 사업자)가 운영하는 2WH 사이버 몰(이하 "몰"이라 한다)에서 제공하는 인터넷 관련 서비스(이하 "서비스"라 한다)를 이용함에 있어 사이버 몰과 이용자의 권리․의무 및 책임사항을 규정함을 목적으로 합니다.

                    제2조(정의)
① "몰"이란 주식회사 2WH가 재화 또는 용역(이하 "재화 등"이라 함)을 이용자에게 제공하기 위하여 컴퓨터 등 정보통신설비를 이용하여 재화 등을 거래할 수 있도록 설정한 가상의 영업장을 말하며, 아울러 사이버몰을 운영하는 사업자의 의미로도 사용합니다.`
                },
                2: {
                    title: '개인정보 수집 및 이용 동의',
                    content: `1. 수집하는 개인정보의 항목
회사는 회원가입, 상담, 서비스 신청 등을 위해 아래와 같은 개인정보를 수집하고 있습니다.
ο 수집항목 : 이름 , 로그인ID , 비밀번호 , 자택 전화번호 , 자택 주소 , 휴대전화번호 , 이메일 , 서비스 이용기록 , 접속 로그 , 쿠키 , 접속 IP 정보
ο 개인정보 수집방법 : 홈페이지(회원가입)`
                },
                3: {
                    title: '위치기반서비스 이용약관',
                    content: `제1조 (목적)
본 약관은 회사가 제공하는 위치기반서비스와 관련하여 회사와 개인위치정보주체와의 권리, 의무 및 책임사항, 기타 필요한 사항을 규정함을 목적으로 합니다.

제2조 (약관의 효력 및 변경)
① 본 약관은 서비스를 신청한 고객 또는 개인위치정보주체가 본 약관에 동의하고 회사가 정한 소정의 절차에 따라 서비스의 이용자로 등록함으로써 효력이 발생합니다.`
                }
            },

            // 약관 표시 메서드
            show(termType) {
                const modal = document.getElementById('termsModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalContent = document.getElementById('modalContent');
                const checkbox = document.getElementById(`terms${termType}`);

                currentTermType = termType;
                const term = this.contents[termType];

                modalTitle.textContent = term.title;
                modalContent.textContent = term.content;
                modal.style.display = "block";
                checkbox.disabled = false;
            },

            // 약관 동의 처리 메서드
            agree() {
                if (currentTermType) {
                    const checkbox = document.getElementById(`terms${currentTermType}`);
                    checkbox.checked = true;
                    this.updateAllTermsCheckbox();
                    document.getElementById('termsModal').style.display = "none";
                }
            },

            // 전체 동의 체크박스 상태 업데이트
            updateAllTermsCheckbox() {
                const allChecked = [...document.querySelectorAll('.required-terms')]
                    .every(box => box.checked);
                document.getElementById('termsAll').checked = allChecked;
            },

            // 약관 동의 검증
            validate() {
                const requiredTerms = document.querySelectorAll('.required-terms');
                const isAllTermsChecked = [...requiredTerms].every(checkbox => checkbox.checked);
                if (!isAllTermsChecked) {
                    ValidationUI.showError('terms', '필수 약관에 모두 동의해주세요.');
                    return false;
                }
                return true;
            }
        };

        // 유효성 검사 규칙 객체
        const ValidationRules = {
            companyId: {
                pattern: /^[a-zA-Z0-9]{4,20}$/,
                message: "아이디는 영문, 숫자 4~20자여야 합니다"
            },
            companyPw: {
                pattern: /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/,
                message: "비밀번호는 영문, 숫자, 특수문자 조합 8자 이상이어야 합니다"
            },
            companyPwConfirm: {
                validate: (value, formData) => value === formData.companyPw,
                message: "비밀번호가 일치하지 않습니다"
            },
            companyName: {
                pattern: /^.{2,}$/,
                message: "이름은 2자 이상이어야 합니다"
            },
            companyNumber: {
                pattern: /^\d{3}-\d{2}-\d{5}$/,
                message: "올바른 사업자등록번호 형식이 아닙니다"
            },
            companyContact: {
                pattern: /^\d{2,3}-\d{3,4}-\d{4}$/,
                message: "올바른 전화번호 형식이 아닙니다"
            },
            emailDomain: {
                pattern: /^[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,
                message: "올바른 도메인 형식이 아닙니다"
            }
        };

        // 유효성 검사 UI 관련 객체
        const ValidationUI = {
            showError(field, message) {
                const errorDiv = document.getElementById(`${field}Error`);
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                }
            },

            clearErrors() {
                document.querySelectorAll('.error-message').forEach(div => {
                    div.style.display = 'none';
                });
            }
        };

        // 폼 유효성 검사 객체
        const FormValidator = {
            validateEmail() {
                const emailId = document.getElementById('emailId').value;
                const emailDomain = document.getElementById('emailDomain').value;
                
                if (!emailId) {
                    ValidationUI.showError('companyEmail', '이메일은 필수 입력 항목입니다.');
                    document.getElementById('emailId').focus();
                    return false;
                }

                if (!emailDomain) {
                    ValidationUI.showError('companyEmail', '이메일 도메인은 필수 입력 항목입니다.');
                    document.getElementById('emailDomain').focus();
                    return false;
                }

                if (!ValidationRules.emailDomain.pattern.test(emailDomain)) {
                    ValidationUI.showError('companyEmail', ValidationRules.emailDomain.message);
                    document.getElementById('emailDomain').focus();
                    return false;
                }

                return true;
            },

            validateRequired(formData) {
                const requiredFields = [
                    'companyId', 'companyPw', 'companyPwConfirm', 'companyName', 
                    'companyNumber', 'companyAddress', 'companyContact'
                ];

                for (const field of requiredFields) {
                    if (!formData[field]) {
                        ValidationUI.showError(field, '필수 입력 항목입니다.');
                        return false;
                    }
                }

                return true;
            },

            validateAll(formData) {
                ValidationUI.clearErrors();

                // 1. 아이디 검증
                if (!this.validateCompanyId(formData.companyId)) return false;
                
                // 2. 비밀번호 검증
                if (!this.validatePassword(formData)) return false;
                
                // 3. 회사명 검증
                if (!this.validateCompanyName(formData.companyName)) return false;
                
                // 4. 연락처 검증
                if (!this.validateContact(formData.companyContact)) return false;
                
                // 5. 이메일 검증
                if (!this.validateEmail()) return false;
                
                // 6. 나머지 필수 필드 검증
                if (!this.validateRemainingFields(formData)) return false;
                
                // 7. 약관 동의 검증
                if (!Terms.validate()) return false;

                return true;
            },

            validateCompanyId(companyId) {
                if (!companyId) {
                    ValidationUI.showError('companyId', '필수 입력 항목입니다.');
                    document.getElementById('companyId').focus();
                    return false;
                }

                if (!ValidationRules.companyId.pattern.test(companyId)) {
                    ValidationUI.showError('companyId', ValidationRules.companyId.message);
                    document.getElementById('companyId').focus();
                    return false;
                }

                // 중복확인 여부 검증
                const isValidated = document.getElementById('companyId').getAttribute('data-validated') === 'true';
                if (!isValidated) {
                    ValidationUI.showError('companyId', '아이디 중복확인이 필요합니다.');
                    document.getElementById('companyId').focus();
                    return false;
                }

                return true;
            },

            validatePassword(formData) {
                if (!formData.companyPw) {
                    ValidationUI.showError('companyPw', '필수 입력 항목입니다.');
                    document.getElementById('companyPw').focus();
                    return false;
                }

                if (!ValidationRules.companyPw.pattern.test(formData.companyPw)) {
                    ValidationUI.showError('companyPw', ValidationRules.companyPw.message);
                    document.getElementById('companyPw').focus();
                    return false;
                }

                if (formData.companyPw !== formData.companyPwConfirm) {
                    ValidationUI.showError('companyPwConfirm', '비밀번호가 일치하지 않습니다.');
                    document.getElementById('companyPwConfirm').focus();
                    return false;
                }

                return true;
            },

            validateCompanyName(companyName) {
                if (!companyName) {
                    ValidationUI.showError('companyName', '필수 입력 항목입니다.');
                    document.getElementById('companyName').focus();
                    return false;
                }

                if (!ValidationRules.companyName.pattern.test(companyName)) {
                    ValidationUI.showError('companyName', ValidationRules.companyName.message);
                    document.getElementById('companyName').focus();
                    return false;
                }

                return true;
            },

            validateContact(contact) {
                if (!contact) {
                    ValidationUI.showError('companyContact', '필수 입력 항목입니다.');
                    document.getElementById('companyContact').focus();
                    return false;
                }

                if (!ValidationRules.companyContact.pattern.test(contact)) {
                    ValidationUI.showError('companyContact', ValidationRules.companyContact.message);
                    document.getElementById('companyContact').focus();
                    return false;
                }

                return true;
            },

            validateRemainingFields(formData) {
                const requiredFields = [
                    'companyNumber',
                    'companyAddress',
                    'companyZonecode',
                    'companyAddressDetail'
                ];

                for (const field of requiredFields) {
                    if (!formData[field]) {
                        ValidationUI.showError(field, '필수 입력 항목입니다.');
                        document.getElementById(field).focus();
                        return false;
                    }
                }

                // 사업자등록번호 형식 검증
                if (!ValidationRules.companyNumber.pattern.test(formData.companyNumber)) {
                    ValidationUI.showError('companyNumber', ValidationRules.companyNumber.message);
                    document.getElementById('companyNumber').focus();
                    return false;
                }

                return true;
            },

            validateCompanyNumber(number) {
                if (!number) {
                    ValidationUI.showError('companyNumber', '사업자등록번호는 필수 입력 항목입니다.');
                    document.getElementById('companyNumber').focus();
                    return false;
                }

                if (!ValidationRules.companyNumber.pattern.test(number)) {
                    ValidationUI.showError('companyNumber', ValidationRules.companyNumber.message);
                    document.getElementById('companyNumber').focus();
                    return false;
                }

                return true;
            },

            validateAddress(addressData) {
                if (!addressData.companyZonecode) {
                    ValidationUI.showError('companyAddress', '우편번호는 필수 입력 항목입니다.');
                    document.getElementById('companyZonecode').focus();
                    return false;
                }

                if (!addressData.companyAddress) {
                    ValidationUI.showError('companyAddress', '주소는 필수 입력 항목입니다.');
                    document.getElementById('companyAddress').focus();
                    return false;
                }

                if (!addressData.companyAddressDetail) {
                    ValidationUI.showError('companyAddress', '상세주소는 필수 입력 항목입니다.');
                    document.getElementById('companyAddressDetail').focus();
                    return false;
                }

                return true;
            }
        };

        // 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', function() {
            // 약관 관련 이벤트 리스너
            document.querySelectorAll('.terms-view').forEach(button => {
                button.addEventListener('click', function() {
                    const termType = this.getAttribute('data-term-type');
                    Terms.show(parseInt(termType));
                });
            });

            // 전체 동의 체크박스 처리
            document.getElementById('termsAll').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.terms-checkbox');
                checkboxes.forEach(checkbox => {
                    if (!checkbox.disabled) {
                        checkbox.checked = this.checked;
                    }
                });
            });

            // 폼 제출 처리
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                ValidationUI.clearErrors();

                // 순차적 검증 - 지정된 순서대로
                // 1. 아이디
                if (!FormValidator.validateCompanyId(document.getElementById('companyId').value)) return;
                
                // 2. 비밀번호
                if (!FormValidator.validatePassword({
                    companyPw: document.getElementById('companyPw').value,
                    companyPwConfirm: document.getElementById('companyPwConfirm').value
                })) return;
                
                // 3. 회사명
                if (!FormValidator.validateCompanyName(document.getElementById('companyName').value)) return;
                
                // 4. 사업자등록번호
                if (!FormValidator.validateCompanyNumber(document.getElementById('companyNumber').value)) return;
                
                // 5. 주소 관련 필드
                if (!FormValidator.validateAddress({
                    companyAddress: document.getElementById('companyAddress').value,
                    companyZonecode: document.getElementById('companyZonecode').value,
                    companyAddressDetail: document.getElementById('companyAddressDetail').value
                })) return;
                
                // 6. 연락처
                if (!FormValidator.validateContact(document.getElementById('companyContact').value)) return;
                
                // 7. 이메일
                if (!FormValidator.validateEmail()) return;
                
                // 8. 약관 동의
                if (!Terms.validate()) return;

                // API 호출을 위한 데이터 준비
                const formData = {
                    companyId: document.getElementById('companyId').value,
                    companyPw: document.getElementById('companyPw').value,
                    companyPwConfirm: document.getElementById('companyPwConfirm').value,
                    companyName: document.getElementById('companyName').value,
                    companyNumber: document.getElementById('companyNumber').value.replace(/-/g, ''),
                    companyAddress: document.getElementById('companyAddress').value,
                    companyZonecode: document.getElementById('companyZonecode').value,
                    companyAddressDetail: document.getElementById('companyAddressDetail').value,
                    companyContact: document.getElementById('companyContact').value,
                    companyEmail: `${document.getElementById('emailId').value}@${document.getElementById('emailDomain').value}`,
                    companyWebsite: document.getElementById('companyWebsite').value,
                    companyBirth: document.getElementById('companyBirth').value,
                    companyEmployee: document.getElementById('companyEmployee').value,
                    companyProfit: document.getElementById('companyProfit').value
                };

                // API 호출
                try {
                    const response = await axios.post('/api/auth/company/signup', formData);
                    alert(response);
                    location.href = '/login';
                } catch (error) {
                    console.log(error);
                    if (error.status === 400) {
                        if (error.type === 'VALIDATION_ERROR') {
                            // 유효성 검사 에러 (필드별 에러)
                            Object.entries(error.body).forEach(([field, message]) => {
                                ValidationUI.showError(field, message);
                            });
                        }
                    }
                }
            });

            // companyId input 이벤트 리스너 추가
            document.getElementById('companyId').addEventListener('input', function() {
                this.setAttribute('data-validated', 'false');
                if (this.value) {  // 값이 있을 경우에만
                    ValidationUI.showError('companyId', '아이디 중복확인이 필요합니다.');
                } else {
                    ValidationUI.clearErrors();  // 값이 없으면 에러메시지 제거
                }
            });
        });

        // 전화번호 자동 하이픈 추가
        document.getElementById('companyContact').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length > 3 && value.length <= 7) {
                value = value.slice(0,3) + '-' + value.slice(3);
            } else if (value.length > 7) {
                value = value.slice(0,3) + '-' + value.slice(3,7) + '-' + value.slice(7,11);
            }
            e.target.value = value;
        });

        // 사업자등록번호 자동 하이픈 추가
        document.getElementById('companyNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length > 3 && value.length <= 5) {
                value = value.slice(0,3) + '-' + value.slice(3);
            } else if (value.length > 5) {
                value = value.slice(0,3) + '-' + value.slice(3,5) + '-' + value.slice(5,10);
            }
            e.target.value = value;
        });

        // 아이디 중복확인
        async function checkDuplicate() {
            const companyId = document.getElementById('companyId').value;
            if (!ValidationRules.companyId.pattern.test(companyId)) {
                ValidationUI.showError('companyId', ValidationRules.companyId.message);
                return;
            }

            try {
                const response = await axios.post('/api/auth/company/check-duplicate', { companyId });
                if (response.body.success) {
                    ValidationUI.clearErrors();
                    alert('사용 가능한 아이디입니다.');
                    document.getElementById('companyId').setAttribute('data-validated', 'true');
                } else {
                    ValidationUI.showError('companyId', '이미 사용중인 아이디입니다.');
                    document.getElementById('companyId').setAttribute('data-validated', 'false');
                }
            } catch (error) {
                alert('중복 확인 중 오류가 발생했습니다.');
            }
        }

        // 주소 검색
        function searchAddress() {
            new daum.Postcode({
                oncomplete: function(data) {
                    document.getElementById('companyZonecode').value = data.zonecode;
                    document.getElementById('companyAddress').value = data.address;
                    document.getElementById('companyAddressDetail').focus();
                }
            }).open();
        }


        // 모달 닫기 기능
        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('termsModal').style.display = "none";
        });

        // 모달 외부 클릭 시 닫기
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('termsModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });

        // 약관 보기 버튼 클릭 이벤트
        document.querySelectorAll('.terms-view').forEach(button => {
            button.addEventListener('click', function() {
                const termType = this.getAttribute('data-term-type');
                Terms.show(parseInt(termType));
            });
        });

        // 체크박스 직접 클릭 방지
        document.querySelectorAll('.required-terms').forEach(checkbox => {
            checkbox.addEventListener('click', function(e) {
                if (this.disabled) {
                    e.preventDefault();
                    alert('약관을 확인하고 동의해주세요.');
                }
            });
        });
    </script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</th:block>
</body>
</html> 